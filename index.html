
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>En Fouple ðŸ’œ</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.tailwindcss.com"></script>

<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=Work+Sans:wght@300;400;500&display=swap" rel="stylesheet">

<style>
body{
 margin:0;
 font-family:'Work Sans',sans-serif;
 background:linear-gradient(135deg,#0f0f14,#1a1a2e,#0f0f14);
 color:white;
 overflow-x:hidden;
}
.cormorant{font-family:'Cormorant Garamond',serif}

.glow{
 position:fixed;
 width:500px;
 height:500px;
 border-radius:50%;
 filter:blur(120px);
 opacity:.25;
 z-index:0;
}

.card{
 backdrop-filter:blur(20px);
 background:rgba(255,255,255,.05);
 border:1px solid rgba(255,255,255,.08);
 box-shadow:0 10px 40px rgba(0,0,0,.6);
}

.modal{
 position:fixed;
 inset:0;
 background:rgba(0,0,0,.7);
 display:none;
 align-items:center;
 justify-content:center;
 z-index:50;
}
</style>
</head>

<body>

<div class="glow bg-purple-600" style="top:-150px;left:10%"></div>
<div class="glow bg-pink-600" style="bottom:-150px;right:10%"></div>

<div class="p-6 max-w-5xl mx-auto relative z-10">

<h1 class="text-5xl cormorant mb-10">En Fouple ðŸ’œ</h1>

<div id="cats" class="grid md:grid-cols-2 gap-6"></div>

<button onclick="openModal()"
class="fixed bottom-8 right-8 bg-purple-700 px-6 py-3 rounded-full shadow-xl">
Nouveau
</button>

</div>

<!-- MODAL -->
<div id="modal" class="modal">

<div class="card p-6 w-96 rounded-xl">

<h3 class="text-xl mb-4 cormorant">Nouveau message</h3>

<select id="catSelect"
class="text-black p-2 rounded w-full mb-3"></select>

<textarea id="msgText"
class="text-black p-2 rounded w-full mb-3"
rows="4"></textarea>

<button onclick="sendMsg()"
class="bg-purple-700 px-4 py-2 rounded">
Envoyer
</button>

</div>
</div>

<script>

/* ðŸ”‘ CLÃ‰S */
const SUPABASE_URL="https://kuqctucmvebpenqucquk.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt1cWN0dWNtdmVicGVucXVjcXVrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzNzMwNDcsImV4cCI6MjA4NTk0OTA0N30.GVxDR-izhm3MqOM0elCuvNQlwAffVeUmTVZHz7dlZtA";

const db=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

/* CATÃ‰GORIES */
const CATS=[
 {id:"memorables",name:"MÃ©morables",grad:"from-purple-900 to-pink-900"},
 {id:"questions",name:"Questions intimes",grad:"from-violet-900 to-purple-900"},
 {id:"chemin",name:"Notre chemin",grad:"from-indigo-900 to-blue-900"},
 {id:"projets",name:"Projets & Envies",grad:"from-rose-900 to-orange-900"}
];

let msgs=[];

/* DEVICE ID */
let devId=localStorage.getItem("ef-dev");
if(!devId){
 devId="dev-"+crypto.randomUUID();
 localStorage.setItem("ef-dev",devId);
}

/* LOAD */
async function load(){

 const {data}=await db
  .from("messages")
  .select("*")
  .order("timestamp",{ascending:false});

 msgs=data||[];
 renderCats();
}

/* REALTIME */
db.channel("msgs")
 .on("postgres_changes",
  {event:"*",schema:"public",table:"messages"},
  load)
 .subscribe();

/* RENDER */
function renderCats(){

 const wrap=document.getElementById("cats");
 wrap.innerHTML="";

 CATS.forEach(c=>{

  const count=msgs.filter(m=>m.category===c.id).length;

  wrap.innerHTML+=`
  <div class="card p-6 rounded-2xl bg-gradient-to-br ${c.grad}">
   <h2 class="text-2xl cormorant">${c.name}</h2>
   <p class="opacity-70 mt-2">${count} messages</p>
  </div>`;

 });

 const sel=document.getElementById("catSelect");
 sel.innerHTML=CATS.map(c=>
  `<option value="${c.id}">${c.name}</option>`
 ).join("");
}

/* MODAL */
function openModal(){
 document.getElementById("modal").style.display="flex";
}

function closeModal(){
 document.getElementById("modal").style.display="none";
}

/* SEND */
async function sendMsg(){

 const text=document.getElementById("msgText").value;
 const cat=document.getElementById("catSelect").value;

 if(!text) return;

 await db.from("messages").insert({
  category:cat,
  text,
  timestamp:Date.now(),
  device_id:devId,
  replies:[],
  edited:false
 });

 document.getElementById("msgText").value="";
 closeModal();
}

/* INIT */
load();

</script>

</body>
</html>
